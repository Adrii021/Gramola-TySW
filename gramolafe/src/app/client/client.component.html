<div class="home">
  <div class="home-container">
    <header class="home-header">
      <div class="brand">
        üéµ <span>Gramola</span> Client
      </div>
      <button class="logout-btn" (click)="exit()">Salir</button>
    </header>

    <div class="card">
      <h2 class="welcome">Est√°s en: <span style="color:#1db954">{{ barName }}</span> üçª</h2>
      <p class="subtitle">Pide tu canci√≥n favorita</p>

      <!-- Now playing preview -->
      <div *ngIf="currentPlayback && currentPlayback.item" class="nowplaying-card" style="margin-bottom:18px;">
        <div class="track">
          <img *ngIf="currentPlayback.item.album && currentPlayback.item.album.images && currentPlayback.item.album.images.length>0" [src]="currentPlayback.item.album.images[0].url" />
          <div class="track-info">
            <div class="track-name">{{ currentPlayback.item.name }}</div>
            <div class="track-artist" *ngIf="currentPlayback.item.artists && currentPlayback.item.artists.length>0">{{ currentPlayback.item.artists[0].name }}</div>
            <div style="font-size:0.85rem; color:#9ca3af;">Progreso: {{ currentPlayback.progress_ms }} ms</div>
          </div>
          <div style="width:120px; text-align:right; color:#9ca3af;">Cola: {{ queue.length }}</div>
        </div>
      </div>


      <div class="search">
        <input type="text" [(ngModel)]="query" placeholder="Busca tu temazo..." (keyup.enter)="search()" />
        <button class="btn-primary" (click)="search()">Buscar</button>
      </div>

      <div *ngIf="tracks.length > 0">
        <h3 class="section-title">Resultados</h3>
        <div *ngFor="let item of tracks">
          <div class="track">
            <img *ngIf="item.album && item.album.images" [src]="item.album.images[0].url" alt="cover"/>
            <div class="track-info">
              <div class="track-name">{{ item.name }}</div>
              <div class="track-artist" *ngIf="item.artists">{{ item.artists[0].name }}</div>
            </div>
            <button class="add-btn" (click)="preAdd(item)">Pedir</button>
          </div>
        </div>
      </div>
      
      <div *ngIf="tracks.length === 0 && query.length > 2" class="empty-state">
        Sin resultados...
      </div>
    </div>
  </div>
</div>

<div class="modal-overlay" *ngIf="showPaymentModal">
  <div class="modal-content payment-modal">
    <h3>üéµ Pedir canci√≥n</h3>
    <p>¬øC√≥mo quieres que suene <strong>{{ pendingTrack?.name }}</strong>?</p>
    
    <div class="options" *ngIf="!showStripeForm" style="justify-content:center;">
      <div class="option-card priority" (click)="initiatePriorityPayment()">
        <h4>A√±adir Canci√≥n</h4>
        <p class="price">{{ songPrice }} ‚Ç¨</p>
        <small>¬°A√±√°de tu canci√≥n a la lista!</small>
      </div>
    </div>

    <div class="stripe-section" *ngIf="showStripeForm">
      <div class="card-wrapper">
        <div id="card-element-song"></div>
      </div>
      
      <button class="btn-primary pay-btn" (click)="confirmPayment()" [disabled]="processing">
        {{ processing ? 'Procesando...' : 'Pagar ' + songPrice + ' ‚Ç¨' }}
      </button>
    </div>

    <button class="close-btn" (click)="closeModal()">Cancelar</button>
  </div>
</div>