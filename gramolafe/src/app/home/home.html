<div class="main-container">
    
    <header class="app-header">
        <h1 class="brand-title">ğŸµ Gramola</h1>
        <button (click)="logout()" class="btn btn-danger">
            Cerrar SesiÃ³n
        </button>
    </header>

    <div class="dashboard-card">
        <h2 class="welcome-title">Hola, {{ barName }} ğŸ‘‹</h2>
        <p class="subtitle">Gestiona la mÃºsica de tu local</p>
        
        <div *ngIf="!showingSettings" class="search-container">
            <input type="text" [(ngModel)]="query" placeholder="Buscar canciÃ³n o artista..." 
                   (keyup.enter)="search()"
                   class="input-modern">
            
            <button (click)="search()" class="btn btn-primary">
                ğŸ” Buscar
            </button>
        </div>

        <div *ngIf="tracks.length > 0 && !showingPlaylist && !showingSettings" class="track-list">
            <h3 style="color: #4f46e5; margin-bottom: 15px;">Resultados:</h3>
            
            <div *ngFor="let track of tracks" class="track-item">
                <img *ngIf="track.album?.images[0]" [src]="track.album.images[0].url" class="album-art">
                
                <div class="track-info">
                    <span class="track-title">{{ track.name }}</span>
                    <span class="track-artist">{{ track.artists[0].name }}</span>
                </div>
                
                <button (click)="add(track)" class="btn btn-success" style="padding: 6px 12px; font-size: 0.9rem;">
                    â• AÃ±adir
                </button>
            </div>
        </div>

        <div *ngIf="showingPlaylist && !showingSettings" class="track-list">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <h3 style="color: #4f46e5; margin: 0;">ğŸ“œ Tu Lista de ReproducciÃ³n</h3>
                <span class="subtitle" style="margin: 0;">{{ playlist.length }} canciones</span>
            </div>
            
            <p *ngIf="playlist.length === 0" style="color: #9ca3af; text-align: center; padding: 20px;">
                La lista estÃ¡ vacÃ­a. Â¡AÃ±ade mÃºsica para empezar la fiesta! ğŸ‰
            </p>

            <div *ngFor="let item of playlist; let i = index" class="track-item" style="flex-direction: column; align-items: stretch;">
                
                <div style="display: flex; align-items: center; margin-bottom: 10px;">
                    <span style="font-weight: 700; color: #d1d5db; margin-right: 15px; font-size: 1.2rem;">#{{ i + 1 }}</span>

                    <img *ngIf="item.imageUrl" [src]="item.imageUrl" class="album-art" style="margin-right: 15px;">
                    
                    <div class="track-info">
                        <span class="track-title">{{ item.name }}</span>
                        <span class="track-artist">{{ item.artist }}</span>
                    </div>

                    <button (click)="remove(item.spotifyId)" class="btn btn-ghost" title="Borrar canciÃ³n">
                        ğŸ—‘ï¸
                    </button>
                </div>

                <iframe [src]="getEmbedUrl(item.spotifyId)" 
                        width="100%" 
                        height="80" 
                        frameBorder="0" 
                        allow="encrypted-media" 
                        style="border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
                </iframe>
            </div>
        </div>

        <div *ngIf="showingSettings" class="settings-modal">
            <h3 style="color: #111827; margin-top: 0; margin-bottom: 20px;">âš™ï¸ Editar Perfil</h3>
            
            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 600; font-size: 0.9rem;">Nombre del Bar</label>
                <input type="text" [(ngModel)]="editData.name" class="input-modern">
            </div>

            <div style="margin-bottom: 25px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 600; font-size: 0.9rem;">Nueva ContraseÃ±a</label>
                <input type="password" [(ngModel)]="editData.password" placeholder="Deja en blanco para no cambiar" class="input-modern">
            </div>

            <div style="display: flex; justify-content: flex-end; gap: 10px;">
                <button (click)="cancelSettings()" class="btn" style="background: #e5e7eb; color: #374151;">
                    Cancelar
                </button>
                <button (click)="saveSettings()" class="btn btn-primary">
                    ğŸ’¾ Guardar Cambios
                </button>
            </div>
        </div>

        <hr style="border: 0; border-top: 1px solid #e5e7eb; margin: 30px 0;">

        <div class="control-panel">
            <div class="control-card">
                <h3 style="margin-top: 0;">ğŸ“œ Playlist</h3>
                <p style="color: #6b7280; font-size: 0.9rem;">Gestiona quÃ© suena ahora mismo.</p>
                <button (click)="openPlaylist()" class="btn btn-secondary" style="width: 100%; justify-content: center;">
                    Ver Lista
                </button>
            </div>
            
            <div class="control-card">
                <h3 style="margin-top: 0;">âš™ï¸ Ajustes</h3>
                <p style="color: #6b7280; font-size: 0.9rem;">Personaliza tu perfil.</p>
                <button (click)="openSettings()" class="btn btn-secondary" style="width: 100%; justify-content: center;">
                    Editar Perfil
                </button>
            </div>
        </div>
    </div>
</div>