<div class="home">
  <div class="home-container">

    <!-- HEADER -->
    <header class="home-header">
      <div class="brand">
        ðŸŽµ <span>Gramola</span>
      </div>

      <button class="logout-btn" (click)="logout()">
        Cerrar sesiÃ³n
      </button>
    </header>

    <!-- CARD -->
    <div class="card">

      <!-- BIENVENIDA -->
      <h2 class="welcome">
        Hola, {{ barName }} ðŸ‘‹
      </h2>
      <p class="subtitle">
        Gestiona la mÃºsica de tu local
      </p>

      <!-- BUSCADOR -->
      <div class="search">
        <input
          type="text"
          [(ngModel)]="query"
          placeholder="Buscar canciÃ³n o artistaâ€¦"
          (keyup.enter)="search()"
        />
        <button class="btn-primary" (click)="search()">
          Buscar
        </button>
      </div>

      <!-- SWITCH -->
      <div class="view-switch">
        <button
          class="tab-btn"
          [class.active]="!showingPlaylist"
          (click)="showingPlaylist = false"
        >
          Resultados
        </button>

        <button
          class="tab-btn"
          [class.active]="showingPlaylist"
          (click)="openPlaylist()"
        >
          Mi playlist ({{ playlist.length }})
        </button>
      </div>

      <!-- RESULTADOS -->
      <div *ngIf="tracks.length > 0 && !showingPlaylist">
        <h3 class="section-title">Resultados</h3>

        <div *ngFor="let track of tracks" class="track">
          <img
            *ngIf="track.album?.images[0]"
            [src]="track.album.images[0].url"
            alt="cover"
          />

          <div class="track-info">
            <div class="track-name">{{ track.name }}</div>
            <div class="track-artist">
              {{ track.artists[0].name }}
            </div>
          </div>

          <button class="add-btn" (click)="add(track)">
            AÃ±adir
          </button>
        </div>
      </div>

      <!-- PLAYLIST -->
      <div *ngIf="showingPlaylist">

        <div class="playlist-header">
          <h3>ðŸŽ§ Tu playlist</h3>
          <span>{{ playlist.length }} canciones</span>
        </div>

        <p
          *ngIf="playlist.length === 0"
          class="subtitle center"
        >
          AÃºn no has aÃ±adido canciones ðŸŽ¶
        </p>

        <div *ngFor="let item of playlist; let i = index">

          <!-- TRACK -->
          <div
            class="track"
            [class.playing]="currentPlayingId === item.spotifyId"
          >
            <img
              *ngIf="item.imageUrl"
              [src]="item.imageUrl"
              alt="cover"
            />

            <div class="track-info">
              <div class="track-name">
                {{ i + 1 }}. {{ item.name }}
              </div>
              <div class="track-artist">
                {{ item.artist }}
              </div>
            </div>

            <div class="track-actions">
              <button
                class="play-btn"
                [class.active]="currentPlayingId === item.spotifyId"
                (click)="play(item.spotifyId)"
              >
                â–¶ Reproducir
              </button>

              <button
                class="add-btn"
                (click)="remove(item.spotifyId)"
              >
                Quitar
              </button>
            </div>
          </div>

          <!-- SPOTIFY EMBED (ÃšNICO INDICADOR DE REPRODUCCIÃ“N) -->
          <div
            *ngIf="currentPlayingId === item.spotifyId"
            class="spotify-embed"
          >
            <iframe
              [src]="getEmbedUrl(item.spotifyId)"
              width="100%"
              height="80"
              frameborder="0"
              allow="encrypted-media"
            ></iframe>
          </div>

        </div>
      </div>

    </div>
  </div>
</div>
